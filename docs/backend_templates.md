# Getting started with backend templates
Here are some additional informations about backend templates architecture. As an example we take the nodejs express template.

## Files tree
```
.
+-- .teleport.json
+-- package.json
+-- README.md
+-- backend/servers
|   +-- .dockerignore
|   +-- express-webrouter
|   |   +-- Procfile
|   |   +-- _p_Dockerfile
|   |   +-- package.json
|   |   +-- app
|   |   |   +-- index.js
|   |   |   +-- templates
|   |   |   +-- static
|   |   |   +-- ...
|   |   +-- scripts
|   |   |   +-- _p_heroku_run.sh
|   |   |   +-- _p_run.sh
|   |   |   +-- _p_heroku_build.sh
|   |   |   +-- _p_build.sh
|   |   |   +-- ...
|   |   +-- config
|   |   |   +-- _p_controller.yaml
|   |   |   +-- _p_service.yaml
|   |   |   +-- _p_uwsgi.ini
|   |   |   +-- heroku_uwsgi.ini
```

### Root level
- *package.json*: A teleport template is a js package, this file describe the package.
- *.teleport.json*: The teleport configuration file.

### Into backend/servers
- *.dockerignore*: describe files that should be ignored during deployment process.
NB: the name of the folder should match the `serversByName` first key into the `.teleport.json`

### Into express-webrouter
- *Procfile*: define commands that will run on the deployed app. It's specific to Heroku platform (see https://devcenter.heroku.com/articles/procfile).
- *_p_Dockerfile*: define the application image. It's specific to Docker.
- *package.json*: define requirements for the deployed application. It's necessary for the Heroku app to have it at this level, moreover it's specific to our case (nodejs express), for a python app it should be a `requirements.txt` (see https://devcenter.heroku.com/articles/python-pip).

#### app
In this folder you should put all files related to the app. In our example we have an `index.js` to describe the express app and some html templates.

Templates are always into the `templates` folder. You should at least have:
- `_index.html`
```html
<!DOCTYPE html>
<html lang="en">
  <head><% include _dev_bundle.html %></head>
  <body><% include _body.html %></body>
</html>
```

- `_index_prod.html`
```html
<!DOCTYPE html>
<html lang="en">
  <head><% include _prod_bundle.html %></head>
  <body><% include _body.html %></body>
</html>
```

- `_body.html`
```html
<div id="app_div"></div>
```
This is a placeholder for your frontend app. The `app_div` ID is very important as teleport will only match it.

- `_prod_bundle.html` and `_dev_bundle.html` can be empty. These are placeholders for js bundle generated by webpack frontend configuration, so they will be rewritten by a frontend template if you associated one with a backend template.

TODO specific + svgs ?

#### scripts
In this folder you should put all files related to deployment for the different platforms and scripts to start the application. There are 5 files per platform:  
- *build*: build the application.  
For Docker, build the image.
For Heroku, initialize the git repository and create a blank application.

- *push*: push the application.  
For Docker, push the image into a registry and register the kubernetes configuration into a db.
For Heroku, push the code on the heroku remote repository.

- *run*: start the application.  
For Docker, launch the pod (container) regarding the kubernetes config.
For Heroku, start the application previously created.

- *deploy*: build + push + run. Teleport command will call this script.

- *start*: start the application locally.

You should also put a `install.sh` and a `manage` scripts.  
- *install*: install script that teleport will run inside the deployed app. Here it's related to the
- *manage*: contains the server object linked to the app object. In order to separate the express api from the server object we put the http server object into the manage file. It's a way to keep clean the application api.

#### config
In this folder you should put all files related to specific configuration. We set here 2 `.yaml` files related to kubernetes configuration and uwsgi configuration files for flask python app. In our case we do not use uwsgi files as it's python related.
